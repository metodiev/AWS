# 1.2 IAM Roles

##  What is an IAM Role?
An **IAM Role** is an AWS identity with **temporary credentials** that can be assumed by:
- AWS services (EC2, Lambda, ECS tasks)
- Other AWS accounts (cross-account access)
- Federated users (SSO, Active Directory, third-party IdPs)

Unlike IAM Users:
- Roles do **not** have long-term credentials (no password or permanent access keys)
- Roles are **assumed** to gain permissions when needed


##  Learning Objectives
- Understand how IAM Roles differ from IAM Users
- Learn to create and assign IAM Roles
- Use IAM Roles for AWS services, applications, and cross-account scenarios
- Follow AWS security best practices


##  Hands-on Lab: Create a Role for EC2

### Step 1: Open IAM Console
- Go to [IAM Roles](https://console.aws.amazon.com/iam/)

### Step 2: Create Role
- Choose **AWS Service** → **EC2**
- Attach policy → e.g., `AmazonS3ReadOnlyAccess`
- Name the role → `EC2S3ReadOnlyRole`

### Step 3: Assign Role to EC2 Instance
- Launch or select an EC2 instance
- Attach IAM Role `EC2S3ReadOnlyRole`

### Step 4: Test Permissions
- SSH into EC2 instance
- Run:

```bash
  aws s3 ls
```

(It should list S3 buckets without needing access keys)

## CLI Example: Create IAM Role

```bash
# 1. Create trust policy file
cat > trust-policy.json <<EOF
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": { "Service": "ec2.amazonaws.com" },
      "Action": "sts:AssumeRole"
    }
  ]
}
EOF

# 2. Create the role with trust policy
aws iam create-role \
  --role-name EC2S3ReadOnlyRole \
  --assume-role-policy-document file://trust-policy.json

# 3. Attach S3 read-only policy
aws iam attach-role-policy \
  --role-name EC2S3ReadOnlyRole \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
```

### Best Practices for IAM Roles

Prefer Roles over Users for apps and services (no long-term credentials).
Use Instance Profiles for EC2 instead of embedding keys.
Rotate and limit trust relationships (avoid wide * principals).
Least privilege principle – only grant required policies.
Cross-account access via roles, not shared IAM users.


## Exercise

Create an IAM Role AppRole with AmazonDynamoDBFullAccess.

Attach it to an EC2 instance.

From that instance, run:

```bash
aws dynamodb list-tables
```

## Resources

[IAM Roles Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html)

[Using IAM Roles with EC2](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html)

[Best Practices for IAM Roles](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)
